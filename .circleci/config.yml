workflows:
  node-multi-build:
    jobs:
      - test:
        matrix:
          parameters:
            node-version: [6, 8, 10, 12, 14]
            prom-client-version: [10, 11, 12]
          exclude:
            - node-version: 6
              prom-client-version: 12
version: 2.1
jobs:
  test:
    docker:
      - image: node:<< matrix.node-version >>
    working_directory: ~/working_directory
    steps:
      - run:
          name: Versions
          command: yarn versions
      - checkout
      - restore_cache:
          keys:
            - v{{ .Environment.CIRCLE_CACHE_VERSION }}-yarn-lock-{{ .Branch }}-{{ .Environment.CIRCLE_JOB }}-{{ checksum "yarn.lock" }}
            - v{{ .Environment.CIRCLE_CACHE_VERSION }}-yarn-lock-master-{{ .Environment.CIRCLE_JOB }}-{{ checksum "yarn.lock" }}
            - v{{ .Environment.CIRCLE_CACHE_VERSION }}-yarn-cache-{{ .Branch }}-{{ .Environment.CIRCLE_JOB }}
            - v{{ .Environment.CIRCLE_CACHE_VERSION }}-yarn-cache-master-{{ .Environment.CIRCLE_JOB }}
      - run:
          name: Install dependencies
          command: yarn install --ignore-engines
      - run:
          name: Install prom-client@<< matrix.prom-client-version >>
          command: yarn add --dev prom-client@^<< matrix.prom-client-version >> --ignore-engines
      - run:
          name: Test prom-client@<< matrix.prom-client-version >>
          command: yarn test
      - save_cache:
          key: v{{ .Environment.CIRCLE_CACHE_VERSION }}-yarn-lock-{{ .Branch }}-{{ .Environment.CIRCLE_JOB }}-{{ checksum "yarn.lock" }}
          paths:
            - node_modules
      - save_cache:
          key: v{{ .Environment.CIRCLE_CACHE_VERSION }}-yarn-cache-{{ .Branch }}-{{ .Environment.CIRCLE_JOB }}-{{ checksum "yarn.lock" }}
          paths:
            - /usr/local/share/.cache/yarn
            - /root/.cache/yarn
